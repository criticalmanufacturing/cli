# vm installation
steps:
- pwsh: |
    $sc =
    {
        $parameters = "$(EnvConfig.ConfigPath)"
        Set-Location -Path $(DriveLetter)
        $scriptPath = ".\tools\CmfDeploy.exe install --packageToInstall=$(EnvConfig.PackageToInstall) --parameters='$(EnvConfig.ConfigPath)' --packageSources='$(CandidatePackages)',$(DriveLetter) --logFileLocation '$(CandidatePackages)'"
        Write-Host("Script to run: " + $scriptPath)
        Invoke-Expression $scriptPath | Out-Host
        if($LASTEXITCODE)
        {
            throw "Installation Failed on Run CmfDeploy.exe install"
        }
    }
    try
    {
        Invoke-Command -ComputerName $(EnvConfig.Product.ApplicationServer.Address) -ScriptBlock $sc | Out-Host
    }
    catch { throw (" *  Invoke-Command ERROR " + $_) }
  displayName: Install
  timeoutInMinutes: 720 # 12 hours