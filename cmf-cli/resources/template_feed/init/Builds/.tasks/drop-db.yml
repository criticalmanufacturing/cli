# Drop Database
parameters:
  DB: ''
  DBName: ''
  ServerName: ''
steps:
- task: SqlDacpacDeploymentOnMachineGroup@0
  displayName: Drop ${{parameters.DB}} database
  inputs:
    TaskType: sqlInline
    InlineSql: |
      IF EXISTS (SELECT name from sys.databases WHERE (name = N'${{parameters.DBName}}'))
      BEGIN
        EXEC msdb.dbo.sp_delete_database_backuphistory @database_name = N'${{parameters.DBName}}'
        ALTER DATABASE [${{parameters.DBName}}] SET SINGLE_USER WITH ROLLBACK IMMEDIATE
        DROP DATABASE IF EXISTS ${{parameters.DBName}}
      END;
    ServerName: ${{parameters.ServerName}}
    DatabaseName: master
    AuthScheme: sqlServerAuthentication
    SqlUsername: $(Database${{parameters.DB}}User)
    SqlPassword: $(Database${{parameters.DB}}Password)
