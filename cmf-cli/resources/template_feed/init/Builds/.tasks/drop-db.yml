# Drop Database
parameters:
<<<<<<< Updated upstream
    DB: ''
=======
  DB: ''
  DBName: $(EnvConfig.Product.SystemName)
  ServerName: $(EnvConfig.PackageProduct.Database.${{parameters.DB}}.Database.Server)

>>>>>>> Stashed changes
steps:
- task: SqlDacpacDeploymentOnMachineGroup@0
  displayName: Drop ${{parameters.DB}} database
  inputs:
    TaskType: sqlInline
    InlineSql: |
      IF EXISTS (SELECT name from sys.databases WHERE (name = N'${{parameters.DBName}}'))
      BEGIN
        EXEC msdb.dbo.sp_delete_database_backuphistory @database_name = N'${{parameters.DBName}}'
        ALTER DATABASE [${{parameters.DBName}}] SET SINGLE_USER WITH ROLLBACK IMMEDIATE
        DROP DATABASE IF EXISTS ${{parameters.DBName}}
      END;
    ServerName: ${{parameters.ServerName}}
    DatabaseName: master
    AuthScheme: sqlServerAuthentication
<<<<<<< Updated upstream
    SqlUsername: $(EnvConfig.PackageProduct.Database.${{ parameters.DB}}.Database.User)
    SqlPassword: $(EnvConfig.PackageProduct.Database.${{ parameters.DB}}.Database.Password)
=======
    SqlUsername: $(Database${{parameters.DB}}User)
    SqlPassword: $(Database${{parameters.DB}}Password)
>>>>>>> Stashed changes
