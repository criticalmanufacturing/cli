# Post-scaffolding

## 1. Package tailoring

The packages generated by `cmf new` are as neutral, to be compatible with as many deployment scenarios as possible. However, some tailoring is advised for specific targets. This tailoring allows the packages to better adapt to their deployment target, eliminating the need for manual steps when installing.

Below are some tailoring options per CLI version and target environment. for specific targets. It's recommended that these changes be applied according to your target environment.

!!! important

    Preserve the order of steps referenced in this document.

### CLI version 3x

#### [Containers Environment](#tab/containers)

On the _Tests MasterData Package_ **add** the property:

```json

"isToSetDefaultSteps": false

```


#### [Traditional Environment](#tab/deploymentFramework)

On the _Business Package_ **remove** steps:

```json

"steps": [
{
    "order": 1, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/stop_host.ps1" 
},
{ 
    "order": 2, 
    "type": "DeployFiles", 
    "ContentPath": "**/!(Cmf.Custom.*.BusinessObjects*).dll" 
},
{ 
    "order": 3, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/start_host.ps1" 
}
]

```

On _Data_, _IoTData_ and _Tests MasterData Package_ **remove** steps:

```json

"steps": [
{ 
    "order": 1, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/stop_host.ps1" 
},
{ 
    "order": 2, 
    "type": "TransformFile", 
    "file": "Cmf.Foundation.Services.HostService.dll.config", 
    "tagFile": true 
},
{ 
    "order": 3, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/start_host.ps1" 
},
{ 
    "order": 4, 
    "type": "DeployFiles", 
    "ContentPath": "GenerateLBOs.ps1"
},
{ 
    "order": 5, 
    "type": "Generic", 
    "onExecute": "$(Package[Cmf.Custom.Package].TargetDirectory)/GenerateLBOs.ps1" 
}
]

```

### CLI version 2x


#### [Containers Environment](#tab/containers)

On the _Root Package_ **add** "Cmf.Environment" dependency:

```json

"dependencies": [{ 
    "id": "Cmf.Environment", 
    "version": "8.3.0" 
}]

```

On the _Business Package_ **add** the step to exclude custom Business objects deployment (they must be generated by the MES Host Service on the first start-up):

```json

"steps": [{ 
    "order": "1", 
    "type": "DeployFiles", 
    "ContentPath": "**/!(Cmf.Custom.*.BusinessObjects*).dll" 
}]

```

#### [Traditional Environment](#tab/deploymentFramework)

On the _Root_ and _IoT Root Package_ **add** "CriticalManufacturing.DeploymentMetadata" dependency:

```json

"dependencies": [{
    "id": "CriticalManufacturing.DeploymentMetadata", "
    version": "8.3.0" 
}]

```

On the _Business Package_ **add the following steps to :

```json

"steps": [
{ 
    "order": 1,
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/stop_host.ps1" 
},
{ 
    "order": 2,
    "type": "DeployFiles", 
    "ContentPath": "**/!(Cmf.Custom.*.BusinessObjects*).dll" 
},
{ 
    "order": 3,
    "type": "Generic",
     "onExecute": "$(Agent.Root)/agent/scripts/start_host.ps1" 
}]

```

On _Data_, _IoTData_ and _Tests MasterData Package_ **add** steps:

```json
"steps": [
{ 
    "order": 1, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/stop_host.ps1" 
},
{ 
    "order": 2, 
    "type": "TransformFile", 
    "file": "Cmf.Foundation.Services.HostService.dll.config", 
    "tagFile": true 
},
{ 
    "order": 3, 
    "type": "Generic", 
    "onExecute": "$(Agent.Root)/agent/scripts/start_host.ps1" 
},
{ 
    "order": 4,
    "type": "DeployFiles", 
    "ContentPath": "GenerateLBOs.ps1" 
},
{ 
    "order": 5, 
    "type": "Generic", 
    "onExecute": "$(Package[Cmf.Custom.Package].TargetDirectory)/GenerateLBOs.ps1" 
}]

```

## 2. Store project on source control

Store the results of project scaffolding on the source control.

## 3. Automate the release process

If possible automate your release process.

!!! note

    CM has created the `cmf-pipelines` CLI plugin to automate the release process for
    teams using its internal infrastructure.  
    The CI/CD pipelines highly depend on the technology and infrastructure being
    used for the project, and due to that, this plugin is not publicly available.
    More information is available on [CM Internal Development Portal](https://docs.ds.criticalmanufacturing.dev).
